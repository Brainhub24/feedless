<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
      <ion-button (click)="toggleFav()">
        <ion-icon name="star-outline" *ngIf="!articleRef.favored"></ion-icon>
        <ion-icon
          name="star"
          color="primary"
          *ngIf="articleRef.favored"
        ></ion-icon>
      </ion-button>
      <ion-button (click)="renderFulltext()"
        ><ion-icon name="book-outline"></ion-icon>
      </ion-button>
      <ion-button
        (click)="toggleBetterRead()"
        [color]="betterRead ? 'primary' : ''"
        ><strong>B</strong>R
      </ion-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-button (click)="showSettings()">
        <ion-icon name="ellipsis-vertical"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div *ngIf="loading" style="display: flex; height: 100px">
    <ion-spinner style="margin: auto"></ion-spinner>
  </div>
  <ng-container *ngIf="!loading">
    <div class="narrator" [ngClass]="{ playing: playing }" #narrator>
      <p>
        <a [routerLink]="'/source/' + articleRef.article.source_url">Source</a>
      </p>
      <h1>
        <a [href]="articleRef.article.url">{{ title }}</a>
      </h1>
      <p *ngIf="articleRef.article.author">
        by {{ articleRef.article.author }}
      </p>
      <div
        class="ion-padding-top"
        *ngIf="articleRef.article.enclosure"
        [innerHTML]="getEnclosure()"
      ></div>
      <div class="ion-margin-top" [innerHTML]="content"></div>
      <ion-row class="ion-margin-top">
        <ion-col size="3" offset="3" *ngIf="articleRef.article.comment_feed_url"
          ><ion-button [href]="articleRef.article.comment_feed_url"
            >Comments</ion-button
          ></ion-col
        >
        <ion-col size="3"
          ><ion-button [href]="articleRef.article.url" target="_blank"
            >Visit Website</ion-button
          ></ion-col
        >
      </ion-row>
    </div>

    <div class="text-track" *ngIf="currentTextTrack && subtitles">
      <h2>
        <span>{{ currentTextTrack }}</span>
      </h2>
    </div>

    <div class="follow-cursor" *ngIf="!followCursor && lostCursor">
      <ion-button color="dark" (click)="scrollToCursor()"
        >Go to current position</ion-button
      >
    </div>

    <div
      style="
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: white;
      "
    >
      <div class="progress-bar" style="position: relative; height: 5px">
        <div
          style="
            height: 5px;
            background: #cccccc;
            position: absolute;
            transition: width linear 300ms;
          "
          [ngStyle]="{ 'width.%': scrollPosition * 100 }"
        ></div>
        <div
          style="
            height: 5px;
            background: black;
            position: absolute;
            transition: width linear 300ms;
          "
          [ngStyle]="{ 'width.%': progress * 100 }"
        ></div>
      </div>

      <ion-toolbar
        style="background: var(--ion-toolbar-background)"
        *ngIf="canReadOutLoud"
      >
        <div>
          <ion-button
            [disabled]="!canPrevious()"
            (click)="previous()"
            color="light"
          >
            <ion-icon name="play-back"></ion-icon>
          </ion-button>
          <ion-button (click)="togglePlayback()" color="light">
            <ion-icon *ngIf="!playing" name="play"></ion-icon>
            <ion-icon *ngIf="playing" name="pause"></ion-icon>
          </ion-button>
          <ion-button color="light" [disabled]="!canNext()" (click)="next()">
            <ion-icon name="play-forward"></ion-icon>
          </ion-button>
          <ion-button (click)="toggleSubtitles()" color="light">
            <ion-icon name="text-outline"></ion-icon>
          </ion-button>
          <ion-button (click)="toggleFollowCursor()" color="light">
            <ion-icon name="arrow-down-circle-outline"></ion-icon>
          </ion-button>
        </div>
      </ion-toolbar>
    </div>
  </ng-container>
</ion-content>
