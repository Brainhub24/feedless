<ion-header translucent>
  <ion-toolbar>
    <ion-title>Edit Bucket</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismissModal()">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content fullscreen>
  <ion-list>
    <ion-item>
      <ion-label>Name</ion-label>
      <ion-input
        name="name"
        [(ngModel)]="bucket.title"
        placeholder="Enter title"
        maxlength="50"
        required="true"
      ></ion-input>
    </ion-item>
    <ion-item>
      <ion-label>Description</ion-label>
      <ion-input
        name="description"
        [(ngModel)]="bucket.description"
        placeholder="About the content that lands in this bucket"
        maxlength="190"
      ></ion-input>
    </ion-item>
    <ion-item class="ion-margin-bottom">
      <ion-label>
        <h3>Available to others</h3>
        <p *ngIf="!bucket.listed">Feed is private</p>
        <p *ngIf="bucket.listed">Others can subscribe to this bucket</p>
      </ion-label>
      <ion-checkbox name="listed" [(ngModel)]="bucket.listed"></ion-checkbox>
    </ion-item>
    <!--    <ion-item class="ion-margin-bottom">-->
    <!--      <ion-label>URL:</ion-label>-->
    <!--      <ion-input-->
    <!--        readonly="true"-->
    <!--        name="managementUrl"-->
    <!--        [(ngModel)]="managementUrl"-->
    <!--      ></ion-input>-->
    <!--    </ion-item>-->

    <!-- SUBSCRIPTIONS --------------------------------------------------------------------------------------------- -->

    <ion-item
      href="javascript:void(0)"
      (click)="toggle(accordion.subscriptions)"
      [color]="isActive(accordion.subscriptions) ? 'light' : ''"
      detail="true"
    >
      <ion-label>
        <h3>Subscriptions</h3>
        <p>{{ getSubscriptionsCount() }}</p>
      </ion-label>
      <ion-button (click)="addSubscription()"> Add </ion-button>
    </ion-item>
    <ng-container *ngIf="isActive(accordion.subscriptions)">
      <p class="ion-margin" *ngIf="bucket.subscriptions.length === 0">
        <em>No subscriptions yet</em>
      </p>
      <ion-item
        *ngFor="let subscription of bucket.subscriptions"
        href="javascript:void(0)"
        detail
        (click)="editSubscription(subscription)"
      >
        <ion-label>
          <h3>
            {{ subscription.feed?.title }}
          </h3>
          <p>{{ subscription.feed?.home_page_url }}</p>
          <p>
            <ion-chip
              *ngFor="let tag of getTagsForSubscription(subscription)"
              >{{ tag }}</ion-chip
            >
          </p>
        </ion-label>
        <app-bubble
          slot="start"
          [color]="getSubscriptionBubbleColor(subscription)"
        ></app-bubble>
      </ion-item>
    </ng-container>

    <!-- FILTERS --------------------------------------------------------------------------------------------------- -->

    <ion-item
      lines="lines"
      href="javascript:void(0)"
      (click)="showFilters()"
      detail="true"
    >
      <ion-label>
        <h3>Filters</h3>
        <p>keep unwanted data out of your stream</p>
      </ion-label>
    </ion-item>

    <!-- Throttle -------------------------------------------------------------------------------------------------- -->

    <ion-item
      lines="lines"
      href="javascript:void(0)"
      (click)="showThrottle()"
      detail="true"
    >
      <ion-label>
        <h3>Throttle</h3>
        <p>Limit the output of this feed</p>
      </ion-label>
    </ion-item>

    <!-- POST PROCESSORS ------------------------------------------------------------------------------------------- -->

    <ion-item
      lines="lines"
      href="javascript:void(0)"
      (click)="addPostProcessor()"
      detail="true"
    >
      <ion-label>
        <h3>Post Processors</h3>
        <p>Refine the data by running post processors</p>
      </ion-label>
    </ion-item>

    <!-- WEBHOOKS -------------------------------------------------------------------------------------------------- -->

    <!--    <ion-item-->
    <!--      lines="lines"-->
    <!--      href="javascript:void(0)"-->
    <!--      (click)="showWebhooks()"-->
    <!--      detail="true"-->
    <!--    >-->
    <!--      <ion-label>-->
    <!--        <h3>Webhooks</h3>-->
    <!--        <p>Trigger webhooks on bucket event</p>-->
    <!--      </ion-label>-->
    <!--    </ion-item>-->

    <!-- REST CONROL ----------------------------------------------------------------------------------------------- -->

    <!--    <ion-item-->
    <!--      lines="lines"-->
    <!--      href="javascript:void(0)"-->
    <!--      (click)="showRestControl()"-->
    <!--      detail="true"-->
    <!--    >-->
    <!--      <ion-label>-->
    <!--        <h3>REST Control</h3>-->
    <!--        <p>Operate on the bucket using REST</p>-->
    <!--      </ion-label>-->
    <!--    </ion-item>-->
  </ion-list>
</ion-content>
<ion-footer>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button color="danger" (click)="deleteBucket()"
        >Delete Bucket</ion-button
      >
    </ion-buttons>

    <ion-buttons slot="end">
      <ion-button (click)="showHiddenMenu()">
        <ion-icon name="ellipsis-horizontal-outline"></ion-icon>
      </ion-button>
      <ion-button color="primary" (click)="save()" *ngIf="hasChanges()">
        Save Changes
      </ion-button>
      <ion-button
        color="primary"
        (click)="dismissModal()"
        *ngIf="!hasChanges()"
      >
        Close
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
