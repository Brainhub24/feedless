<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>

    <ion-buttons class="ion-float-right">
      <ion-button title="Comment">
        <ion-icon name="chatbubble-outline"></ion-icon>
      </ion-button>
      <ion-button title="Share" (click)="showImportModal()">
        <ion-icon name="share-social-outline"></ion-icon>
      </ion-button>
      <ion-button title="Options">
        <ion-icon name="ellipsis-vertical-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <ion-breadcrumbs>
    <ion-breadcrumb href="/">Home</ion-breadcrumb>
    <ion-breadcrumb [routerLink]="'/bucket/' + bucketId">Bucket</ion-breadcrumb>
    <ion-breadcrumb>Article</ion-breadcrumb>
  </ion-breadcrumbs>

</ion-header>

<ion-content>
  <ion-spinner *ngIf="loading"></ion-spinner>
  <div class="reader" [hidden]="loading">
    <div [ngClass]="{'playing':playing}"
         #narrator>
<!--      <ion-note *ngIf="!loading">{{ createdAt() | date: "dd. MMM. YYYY HH:mm" }}</ion-note>-->
      <h1>{{ getTitle() }}</h1>
      <p>
        <a [href]="article?.content?.url">Website</a>
        <ion-chip [routerLink]="['/bucket', bucket?.id]"
          >Bucket: {{ bucket?.title }}</ion-chip
        >
        <ion-chip [routerLink]="['/feed', nativeFeed?.id, 'feeds']"
          >Feed: {{ nativeFeed?.title }}</ion-chip
        >
      </p>
      <div class="reader-content" [innerHTML]="getContent()"></div>

      <div class="serif reader-content" style="margin-top: 150px; border: 1px solid white"></div>
      <ion-list>
        <ion-item *ngFor="let link of context?.links"
                  [href]="link.url"
                  target="_blank">
          <ion-thumbnail slot="start">
            <img *ngIf="link.imageUrl"
                 [src]="link.imageUrl"  alt=""/>
          </ion-thumbnail>
          <ion-label>
            <h3>{{ link.title }} [{{ getDomain(link.url) }}]</h3>
            <p>{{ link.description }}</p>
          </ion-label>
        </ion-item>
        <app-article
          *ngFor="let article of context?.articles"
          [article]="article"
          [url]="'bucket/' + bucket.id + '/article/' + article.id"
        ></app-article>
      </ion-list>
    </div>

    <div class="text-track"
         *ngIf="currentTextTrack && subtitles">
      <h2><span>{{currentTextTrack}}</span></h2>
    </div>

    <div class="follow-cursor"
         *ngIf="!followCursor && lostCursor">
      <ion-button color="dark"
                  (click)="scrollToCursor()"
        >Go to current position</ion-button
      >
    </div>
  </div>
</ion-content>

<ion-footer>
  <div class="progress-bar"
       style="position: relative; height: 5px">
    <div
      style="
        height: 5px;
        background: #cccccc;
        position: absolute;
        transition: width linear 300ms;
      "
      [ngStyle]="{'width.%': scrollPosition * 100}"
    ></div>
    <div
      style="
        height: 5px;
        background: black;
        position: absolute;
        transition: width linear 300ms;
      "
      [ngStyle]="{'width.%': progress * 100}"
    ></div>
  </div>

  <ion-toolbar>
    <ion-buttons class="ion-justify-content-center">
      <ion-button [disabled]="!canPrevious()"
                  (click)="previous()">
        <ion-icon name="play-back"></ion-icon>
      </ion-button>
      <ion-button (click)="togglePlayback()">
        <ion-icon *ngIf="!playing"
                  name="play"></ion-icon>
        <ion-icon *ngIf="playing"
                  name="pause"></ion-icon>
      </ion-button>
      <ion-button [disabled]="!canNext()"
                  (click)="next()">
        <ion-icon name="play-forward"></ion-icon>
      </ion-button>
      <ion-button (click)="toggleSubtitles()">
        <ion-icon name="text-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="toggleFollowCursor()">
        <ion-icon name="arrow-down-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
