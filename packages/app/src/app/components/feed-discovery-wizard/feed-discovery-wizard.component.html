<div
  style="flex: 1; display: flex; flex-direction: row"
  class="wizard"
  [ngClass]="{
    'wizard--with-body': discovery?.document.htmlBody,
    'wizard--without-body': !discovery?.document.htmlBody
  }"
>
  <div class="menu">
    <ion-searchbar
      placeholder="Enter URL"
      class="menu__searchbar"
      name="url"
      [debounce]="1000"
      *ngIf="!discovery || !discovery?.document.htmlBody"
      (ionChange)="fetchDiscovery()"
      [(ngModel)]="fetchOptions.websiteUrl"
    ></ion-searchbar>

    <ion-accordion-group [value]="['options']" style="flex: 1">
      <ion-accordion value="options">
        <ion-item slot="header">
          <ion-label>Options</ion-label>
        </ion-item>
        <ion-list slot="content">
          <ion-item>
            <ion-checkbox
              name="strictMode"
              slot="start"
              [(ngModel)]="parserOptions.strictMode"
            ></ion-checkbox>
            <ion-label>Strict Rules</ion-label>
          </ion-item>
          <ion-item>
            <ion-checkbox
              name="prerender"
              slot="start"
              (ionChange)="pushQueryParam('prerender', fetchOptions.prerender)"
              [(ngModel)]="fetchOptions.prerender"
            ></ion-checkbox>
            <ion-label>Prerender</ion-label>
          </ion-item>
          <!--          <ion-item *ngIf="options.prerender">-->
          <!--            <ion-checkbox name="fastMode"-->
          <!--                          slot="start"-->
          <!--                          [(ngModel)]="options.puppeteerOptions.fastMode"></ion-checkbox>-->
          <!--            <ion-label>Fast Mode</ion-label>-->
          <!--          </ion-item>-->

          <ion-item *ngIf="fetchOptions.prerender">
            <ion-label>Wait</ion-label>
            <ion-range
              name="wait"
              slot="end"
              (ionChange)="
                pushQueryParam('wait', fetchOptions.prerenderDelayMs)
              "
              [pin]="true"
              [debounce]="500"
              [min]="0"
              [max]="5000"
              [(ngModel)]="fetchOptions.prerenderDelayMs"
            ></ion-range>
          </ion-item>
        </ion-list>
      </ion-accordion>

      <!--      <ion-item-->
      <!--        [button]="true"-->
      <!--        [detail]="true"-->
      <!--        *ngIf="discovery?.mimeType?.startsWith('text/html')"-->
      <!--      >-->
      <!--        <ion-label>Reader</ion-label>-->
      <!--      </ion-item>-->

      <ion-accordion value="native"
                     *ngIf="discovery?.nativeFeeds?.length > 0"
                     [disabled]="genericFeed">
        <ion-item slot="header"
                  [color]="!currentNativeFeed ? 'primary' : undefined">
          <ion-label
            >{{ discovery?.nativeFeeds?.length }} Native Feeds</ion-label
          >
        </ion-item>
        <ion-list slot="content">
          <ion-item
            [button]="true"
            (click)="pickNativeFeed(nativeFeed)"
            *ngFor="let nativeFeed of discovery?.nativeFeeds"
          >
            <ion-icon name="chevron-forward-outline" slot="start"></ion-icon>
            <ion-label>{{ nativeFeed.title }}</ion-label>
            <ion-chip slot="end">native</ion-chip>
          </ion-item>
        </ion-list>
      </ion-accordion>

      <ion-accordion
        value="generic"
        *ngIf="discovery?.genericFeeds?.feeds.length > 0"
      >
        <ion-item slot="header"
                  [color]="!currentGenericFeed ? 'primary' : undefined">
          <ion-label
            >{{ discovery?.genericFeeds?.feeds.length }} Generic
            Feeds</ion-label
          >
        </ion-item>
        <ion-list slot="content" class="limited">
          <ion-item
            [button]="true"
            (click)="pickGenericFeed(genericFeed)"
            [color]="currentGenericFeed?.hash === genericFeed.hash ? 'dark' : undefined"
            *ngFor="let genericFeed of discovery?.genericFeeds.feeds"
          >
            <ion-icon name="chevron-forward-outline" slot="start"></ion-icon>
            <ion-label>Generic with {{ genericFeed.count }} articles</ion-label>
            <ion-chip slot="end">generic</ion-chip>
          </ion-item>
        </ion-list>
      </ion-accordion>

      <ion-accordion
        value="page"
        *ngIf="discovery?.document.mimeType?.startsWith('text/html')"
      >
        <ion-item slot="header">
          <ion-label>Partial Page Changes</ion-label>
        </ion-item>
        <ion-list slot="content">
          <ion-item [button]="true">
            <ion-icon name="chevron-forward-outline" slot="start"></ion-icon>
            <ion-label>Selector</ion-label>
          </ion-item>
          <ion-list>
            <ion-item [button]="true">
              <ion-icon name="chevron-forward-outline" slot="start"></ion-icon>
              <ion-label>Fulltext</ion-label>
            </ion-item>
            <ion-item [button]="true">
              <ion-icon name="chevron-forward-outline" slot="start"></ion-icon>
              <ion-label>Pixel</ion-label>
            </ion-item>
          </ion-list>
        </ion-list>
      </ion-accordion>

      <ion-accordion value="selectors" *ngIf="currentGenericFeed">
        <ion-item slot="header" [color]="currentGenericFeed ? 'primary' : undefined">
          <ion-label>Selectors</ion-label>
        </ion-item>
        <ion-list slot="content">
          <ion-item>
            <ion-input
              slot="end"
              name="linkXPath"
              [(ngModel)]="currentGenericFeed.selectors.linkXPath"
            ></ion-input>
            <ion-label>Link</ion-label>
          </ion-item>
          <ion-item>
            <ion-input
              slot="end"
              name="contextXPath"
              [(ngModel)]="currentGenericFeed.selectors.contextXPath"
            ></ion-input>
            <ion-label>Context</ion-label>
          </ion-item>
          <ion-item>
            <ion-select placeholder="Select fruit"
                        slot="end"
                        name="extendContext"
                        [(ngModel)]="currentGenericFeed.selectors.extendContext">
              <ion-select-option *ngFor="let extendContextOption of getExtendContextOptions()"
                                 [value]="extendContextOption.value">
                {{ extendContextOption.label }}
              </ion-select-option>
            </ion-select>
            <ion-label>Extend Context</ion-label>
          </ion-item>
          <ion-item>
            <ion-input
              slot="end"
              name="dateXPath"
              [required]="parserOptions.eventFeed"
              [(ngModel)]="currentGenericFeed.selectors.dateXPath"
            ></ion-input>
            <ion-label>Date</ion-label>
          </ion-item>
        </ion-list>
      </ion-accordion>

      <ion-list *ngIf="currentGenericFeed">
        <ion-item>
          <ion-checkbox
            name="eventType"
            slot="end"
            [(ngModel)]="parserOptions.eventFeed"
          ></ion-checkbox>
          <ion-label>Event Feed</ion-label>
        </ion-item>
        <ion-item>
          <ion-input
            name="latLon"
            [(ngModel)]="latLon"
          ></ion-input>
          <ion-label>Location</ion-label>
          <ion-button>
            Show Map
          </ion-button>
        </ion-item>
      </ion-list>
    </ion-accordion-group>

    <ion-item
      color="success"
      *ngIf="!currentGenericFeed && !currentNativeFeed"
      (click)="fetchDiscovery()"
      [button]="true"
    >
      <ion-label> Reload </ion-label>
    </ion-item>
    <ion-item
      (click)="previewCurrentFeed()"
      [disabled]="!currentGenericFeed && !currentNativeFeed"
      [button]="true"
    >
      <ion-label> Preview </ion-label>
    </ion-item>
    <ion-item
      [color]="currentGenericFeed ? 'primary' : undefined"
      (click)="useCurrentGenericFeed()"
      *ngIf="currentGenericFeed"
      [button]="true"
    >
      <ion-label> {{ saveLabelPrefix }} Generic Feed </ion-label>
    </ion-item>
    <ion-item
      [color]="currentNativeFeed ? 'primary' : undefined"
      (click)="useCurrentNativeFeed()"
      *ngIf="currentNativeFeed"
      [button]="true"
    >
      <ion-label> {{ saveLabelPrefix }} Native Feed </ion-label>
    </ion-item>
  </div>
  <div class="page-preview">
    <ion-searchbar
      placeholder="Enter URL"
      name="url"
      (ionChange)="fetchDiscovery()"
      [(ngModel)]="fetchOptions.websiteUrl"
    ></ion-searchbar>
    <iframe
      style="flex: 1; position: relative"
      #iframeElement
      sandbox="allow-same-origin"
    ></iframe>
  </div>
</div>
