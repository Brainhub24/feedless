<ion-spinner *ngIf="loading"></ion-spinner>
<ng-container *ngIf="!loading">
  <div
    class="thumbnail"
    [ngStyle]="{ '--image-url': 'url(' + feed.imageUrl + ')' }"
  ></div>

  <ion-row>
    <ion-col size="8">
      <h1 style="display: inline-block">{{ feed?.title }}</h1>
      <ion-chip *ngIf="hasStatusNotFound(feed.status)">Not Found</ion-chip>
      <ion-chip *ngIf="hasNeverBeenFetched(feed.status)"
        >Never Fetched</ion-chip
      >
    </ion-col>
    <ion-col size="4" class="actions">
      <ion-buttons class="ion-float-end">
        <ion-button (click)="handleEdit()"> Edit </ion-button>
        |
        <ion-button (click)="handleDelete()"> Delete </ion-button>
        <ion-button
          *ngIf="authorization?.loggedIn && hasStatusNotFound(feed.status)"
          (click)="fixFeedUrl()"
        >
          Fix Feed URL
          <app-bubble color="red"></app-bubble>
        </ion-button>
        <ion-button fill="solid" color="danger" (click)="openSubscribeModal()">
          Subscribe
        </ion-button>
      </ion-buttons>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
      <app-external-link [url]="feed?.websiteUrl" title="Website">
        <ion-icon name="globe-outline"></ion-icon>
      </app-external-link>
      <app-external-link [url]="feed?.feedUrl" title="Feed">
        <ion-icon name="logo-rss"></ion-icon>
      </app-external-link>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col class="description">
      {{ feed?.description }}
    </ion-col>
    <!--    <p class="ion-margin-vertical">-->
    <!--      {{ feed?.lastUpdatedAt | date: "HH:mm, dd. MMM. YYYY" }}-->
    <!--    </p>-->
  </ion-row>
  <ion-row>
    <ion-col>
      <ion-button color="white">
        {{ feed?.importers.length }}&nbsp;
        <span *ngIf="feed?.importers.length === 1"> Bucket</span>
        <span *ngIf="feed?.importers.length !== 1"> Buckets</span>
      </ion-button>
    </ion-col>
  </ion-row>

  <!--  <ion-accordion-group>-->
  <!--    <ion-accordion value="details">-->
  <!--      <ion-item slot="header">-->
  <!--        <ion-label>Details</ion-label>-->
  <!--      </ion-item>-->
  <!--      <ion-list slot="content">-->
  <!--        <ion-item *ngIf="feed?.genericFeed && feed.genericFeed.id">-->
  <!--          Specified by-->
  <!--          <ion-chip-->
  <!--            color="primary"-->
  <!--            [routerLink]="['/generic-feeds', feed.genericFeed.id]"-->
  <!--          >-->
  <!--            Generic Feed-->
  <!--          </ion-chip>-->
  <!--        </ion-item>-->

  <!--        <ion-item *ngIf="feed && !feed.genericFeed">-->
  <!--          <ion-chip>Native Feed</ion-chip>-->
  <!--        </ion-item>-->

  <!--        <ion-item *ngIf="feed?.importers.length > 0">-->
  <!--          Buckets-->
  <!--          <ion-chip-->
  <!--            *ngFor="let importer of feed?.importers"-->
  <!--            [routerLink]="['/buckets', importer.bucket.id]"-->
  <!--          >{{ importer.bucket.title }}</ion-chip-->
  <!--          >-->
  <!--        </ion-item>-->
  <!--        <ion-item *ngIf="feed?.importers.length === 0">-->
  <!--          <em>Not used in any bucket</em>-->
  <!--        </ion-item>-->
  <!--      </ion-list>-->
  <!--    </ion-accordion>-->
  <!--  </ion-accordion-group>-->

  <app-filter-toolbar
    *ngIf="filters"
    (appFilterChange)="firstPage($event)"
    [filters]="filters"
  >
    <!--    <ion-buttons slot="start">-->
    <!--      <ion-item>-->
    <!--        <ion-checkbox-->
    <!--          aria-label="check all"-->
    <!--          color="success"-->
    <!--          (ionChange)="toggleCheckAll($event)"-->
    <!--        ></ion-checkbox>-->
    <!--      </ion-item>-->

    <!--      <ion-button-->
    <!--        *ngIf="checkedEntities?.length > 0"-->
    <!--        (click)="showBulkActions()"-->
    <!--        color="success"-->
    <!--        fill="solid"-->
    <!--      >-->
    <!--        Actions for {{ checkedEntities?.length }}-->
    <!--      </ion-button>-->
    <!--    </ion-buttons>-->
  </app-filter-toolbar>

  <ion-list>
    <ion-item *ngIf="entities?.length === 0">
      <em>No articles yet</em>
    </ion-item>
    <ion-row *ngFor="let article of entities">
      <!--      <ion-col size="1" class="ion-align-self-center">-->
      <!--        <ion-item>-->
      <!--          <ion-checkbox-->
      <!--            aria-label="check"-->
      <!--            (ionChange)="onCheckChange($event, article)"-->
      <!--            [checked]="isChecked(article)"-->
      <!--            color="success"-->
      <!--          ></ion-checkbox>-->
      <!--        </ion-item>-->
      <!--      </ion-col>-->
      <ion-col size="12">
        <app-article-ref
          [article]="article"
          [showStatus]="false"
          [showDate]="true"
        ></app-article-ref>
      </ion-col>
    </ion-row>
  </ion-list>

  <ion-infinite-scroll
    *ngIf="pagination && pagination?.isLast !== true"
    (ionInfinite)="nextPage($event)"
  >
    <ion-infinite-scroll-content></ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ng-container>
