<ion-header translucent>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="dismissModal()">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>
      <span>Edit Subscription</span>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button
        color="primary"
        fill="solid"
        (click)="updateSubscription()"
        [disabled]="!changed"
      >
        Save
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content fullscreen>
  <ion-list lines="inset">
    <ion-item>
      <ion-label>Name</ion-label>
      <ion-input
        name="name"
        maxlength="50"
        [(ngModel)]="subscription.title"
        [placeholder]="titlePlaceholder"
      ></ion-input>
    </ion-item>
    <ion-item>
      <ion-icon name="pricetags-outline" slot="start"></ion-icon>
      <ion-input
        name="tags"
        [(ngModel)]="stringOfTags"
        placeholder="Comma-separated tags"
      ></ion-input>
    </ion-item>
    <ion-item *ngIf="tagsFromString().length > 0">
      <ion-label>
        <ion-chip *ngFor="let tag of tagsFromString()">{{ tag }}</ion-chip>
      </ion-label>
    </ion-item>
    <ion-item *ngIf="hasBrokenFeedUrl()">
      <ion-label [color]="subscription.feed.broken ? 'red' : null">
        Feed
      </ion-label>
      <ion-input
        required="true"
        type="text"
        name="query"
        placeholder="Enter feed url, website or name"
        [(ngModel)]="subscription.feed.feed_url"
      ></ion-input>
      <ion-button
        *ngIf="!hasChangedFeedUrl()"
        (click)="changeFeedUrl()"
        color="danger"
        >Fix Url</ion-button
      >
      <ion-button
        *ngIf="hasChangedFeedUrl()"
        (click)="changeFeedUrl()"
        color="success"
        >Resolve Url</ion-button
      >
    </ion-item>
    <ion-item-divider> </ion-item-divider>
    <ion-item>
      <ion-card>
        <ion-item>
          <app-bubble
            slot="start"
            [color]="subscription.feed.broken ? 'red' : 'green'"
          ></app-bubble>
          <ion-label>
            <p>Feed</p>
            <h3>{{ subscription.feed.title }}</h3>
            <p>
              <a
                [href]="subscription.feed.home_page_url"
                target="_blank"
                referrerpolicy="no-referrer"
                >{{ subscription.feed.home_page_url }}</a
              >
            </p>
            <p>{{ subscription.feed.description }}</p>
            <app-confirm-button (confirm)="unsubscribe()">
              Unsubscribe
            </app-confirm-button>
            <ion-button
              size="small"
              color="light"
              (click)="showFeedDetails(subscription?.feed)"
            >
              Details
            </ion-button>
            <ion-button
              slot="end"
              (click)="changeFeedUrl()"
              *ngIf="!subscription.feed.broken"
              color="light"
              >Change</ion-button
            >
          </ion-label>
        </ion-item>
      </ion-card>
    </ion-item>
  </ion-list>
</ion-content>
<!--<ion-footer>-->
<!--  <ion-toolbar>-->
<!--    <ion-buttons slot="start">-->
<!--      -->
<!--    </ion-buttons>-->
<!--    <ion-buttons slot="end">-->
<!--      <ion-button (click)="dismissModal()">Deactivate</ion-button>-->
<!--    </ion-buttons>-->
<!--  </ion-toolbar>-->
<!--</ion-footer>-->
