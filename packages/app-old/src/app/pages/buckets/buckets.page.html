<ion-header>
  <app-toolbar>
    <ion-title> Buckets </ion-title>
  </app-toolbar>
</ion-header>

<ion-content>
  <ul>
    <li
      *ngFor="let bucket of buckets"
      class="ion-margin-top"
      style="list-style: none"
    >
      <ion-list>
        <!-- Bucket -->

        <ion-item [routerLink]="'/bucket/'+bucket.id" color="tertiary">
          <ion-label> {{ bucket.title }} </ion-label>
          <ion-button color="dark" size="small" fill="clear" [href]="'feedUrl'">
            <ion-icon name="logo-rss"></ion-icon>
          </ion-button>
        </ion-item>

        <!-- TRIGGER -->
        <ion-item>
          <ion-label> Trigger </ion-label>
          <!--          <ion-select interface="popover" [value]="bucket.trigger_refresh_on">-->
          <!--            <ion-select-option value="change">On Change</ion-select-option>-->
          <!--            <ion-select-option value="scheduled">Scheduled</ion-select-option>-->
          <!--          </ion-select>-->
        </ion-item>
        <ion-item>
          <ion-label> Scheduled </ion-label>
          <ion-input value="every sunday"></ion-input>
        </ion-item>

        <!-- SUBSCRIPTIONS -->
      </ion-list>
      <ion-list>
        <ion-list-header> Subscriptions </ion-list-header>

        <ion-item
          *ngFor="let subscription of bucket.subscriptions"
          class="ion-margin-start"
          draggable="true"
          lines="full"
        >
          <ion-label>
            {{ subscription.title }}

            <ion-note>
              updated {{ getLastUpdatedAt(subscription.lastUpdatedAt) }}
            </ion-note>
          </ion-label>
          <!--          <ion-button color="dark" size="small" fill="clear" [href]="'feedUrl'">-->
          <!--            <ion-icon name="list-outline"></ion-icon>-->
          <!--          </ion-button>-->
          <!--          <ion-button *ngIf="!subscription.feed.broken">Edit</ion-button>-->

          <ng-container *ngIf="subscription.feed.broken">
            <ion-button *ngIf="isOwner(subscription.feed)" color="danger"
              >Fix Feed</ion-button
            >
            <ion-button *ngIf="!isOwner(subscription.feed)" color="danger"
              >Change Feed</ion-button
            >
          </ng-container>

          <ion-button
            fill="clear"
            [routerLink]="'/subscription/' + subscription.id"
          >
            Show
          </ion-button>

          <ion-button color="dark" size="small" fill="clear" [href]="'feedUrl'">
            <ion-icon name="logo-rss"></ion-icon>
          </ion-button>
        </ion-item>
        <ion-item class="ion-margin-start">
          <ion-button size="small" (click)="addSubscription(bucket)">
            Add Subscription
          </ion-button>
        </ion-item>
      </ion-list>

      <!-- EXPORTS -->

      <ion-list>
        <ion-list-header> Exports </ion-list-header>

        <ion-item class="ion-margin-start" [href]="'feedUrl'">
          <ion-label> Feed </ion-label>
          <ion-button color="dark" size="small" fill="clear">
            <ion-icon name="logo-rss"></ion-icon>
          </ion-button>
        </ion-item>
        <ion-item class="ion-margin-start">
          <ion-label> Webhook </ion-label>
          <ion-toggle slot="end"></ion-toggle>
        </ion-item>
        <ion-item class="ion-margin-start">
          <ion-label> Plugins </ion-label>
          <ion-button size="small" (click)="addPlugin(bucket)">
            Add Plugin
          </ion-button>
          <!--          <ion-button color="dark" size="small" fill="clear" [href]="'feedUrl'">-->
          <!--            <ion-icon name="logo-rss"></ion-icon>-->
          <!--          </ion-button>-->
        </ion-item>
        <ion-list class="ion-margin-start" style="border-left: 3px solid white">
          <ion-item>
            <ion-label>
              yt-dl
              <ion-note>https://github.com/damoeb/rich-yt-dl</ion-note>
            </ion-label>
            <ion-button size="small" (click)="addPlugin(bucket)">
              Remove
            </ion-button>
          </ion-item>
          <ion-item>
            <ion-label> Options: </ion-label>
            <ion-input value="youtube-dl"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label> To </ion-label>
            <ion-select (click)="addPlugin(bucket)">
              <ion-select-option value="change">Local Mount</ion-select-option>
            </ion-select>
            <ion-input value="/videos"></ion-input>
          </ion-item>
        </ion-list>

        <ion-item class="ion-margin-start">
          <ion-label> Push </ion-label>
          <ion-toggle slot="end"></ion-toggle>
        </ion-item>
      </ion-list>
    </li>
  </ul>
</ion-content>
