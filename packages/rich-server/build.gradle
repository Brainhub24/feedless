plugins {
	id("org.springframework.boot") version "2.4.0"
	id("io.spring.dependency-management") version "1.0.10.RELEASE"
  id("org.jetbrains.kotlin.jvm") version "1.4.20"
  id "org.jetbrains.kotlin.plugin.spring" version "1.4.20"
}

group = "org.migor.rss"
version = "0.0.1-SNAPSHOT"

java.sourceCompatibility = JavaVersion.VERSION_11

compileKotlin {
  kotlinOptions.jvmTarget = "11"
}
compileTestKotlin {
  kotlinOptions.jvmTarget = "11"
}


apply plugin: 'java'
apply plugin: 'idea'
apply plugin: 'kotlin'
apply plugin: 'kotlin-spring'

sourceSets {
  main.java.srcDirs = []
  main.kotlin.srcDirs = ['src/main/java', 'src/main/kotlin']
  main.resources.srcDirs = ['src/main/resources']
}


repositories {
	mavenCentral()
  flatDir {
    dirs 'libs'
  }
}

def versions = [
  rome: "1.15.0"
]

dependencies {
	implementation("org.springframework.boot:spring-boot-starter-data-jpa")
	implementation("org.springframework.boot:spring-boot-starter-data-rest")
  implementation("org.springframework.boot:spring-boot-starter-thymeleaf")
  implementation("org.springframework.boot:spring-boot-starter-web")
	implementation("com.fasterxml.jackson.module:jackson-module-kotlin")
  implementation 'org.springframework.boot:spring-boot-devtools'
  implementation('org.springframework.boot:spring-boot-starter-validation:2.4.1')

  // json feed
  implementation name: "pertwee-1.1.0"
  implementation 'org.json:json:20201115'
  implementation 'com.google.guava:guava:28.2-jre'

  implementation 'org.apache.commons:commons-lang3:3.11'

  implementation("org.postgresql:postgresql:42.2.18")
  implementation("mysql:mysql-connector-java:8.0.22")
  implementation("org.asynchttpclient:async-http-client:2.12.1")
  implementation("org.jetbrains.kotlin:kotlin-reflect")
  implementation("com.guseyn.broken-xml:broken-xml:1.0.21")
  implementation("com.rometools:rome:${versions.rome}")
  implementation("com.rometools:rome-modules:${versions.rome}")
  implementation("org.jsoup:jsoup:1.13.1")
  implementation("commons-io:commons-io:2.8.0")
  implementation("com.google.code.gson:gson:2.8.6")
  implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
//  implementation 'org.jetbrains.kotlinx:kotlinx-coroutines-core:1.4.2'
//  testImplementation('org.awaitility:awaitility:3.1.2')
  testImplementation("org.springframework.boot:spring-boot-starter-test")
}

task fetchGithubJars(type: Exec) {
  commandLine "sh", "./fetchGithubJars.sh"
}
compileKotlin.dependsOn fetchGithubJars

task compilejjFilterExpr(type: Exec) {
  commandLine "sh", "./compilejj.sh"
}
compileKotlin.dependsOn compilejjFilterExpr

bootRun {
  bootRun.systemProperty 'spring.profiles.active', 'dev'
}
